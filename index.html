<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>Elements</title>
  </head>
  <body>
    <script>
      const RESERVED_PROPS = { key: true, ref: true };

      function ReactElement(type, key, ref, props) {
        return {
          type,
          key,
          ref,
          props,
        };
      }

      function createElement(type, config, ...children) {
        let props = {};
        let key = null,
          ref = null;

        if (config != null) {
          if (config.key !== undefined) key = "" + config.key;
          if (config.ref !== undefined) ref = config.ref;

          for (let prop in config) {
            if (!RESERVED_PROPS.hasOwnProperty(prop)) {
              props[prop] = config[prop];
            }
          }
        }

        if (children.length === 1) {
          props.children = children[0];
        } else if (children.length > 1) {
          props.children = children;
        }

        if (type && type.defaultProps) {
          for (let prop in type.defaultProps) {
            if (props[prop] === undefined)
              props[prop] = type.defaultProps[prop];
          }
        }

        return ReactElement(type, key, ref, props);
      }

      function ComponentButton1(props) {
        return createElement(
          "button",
          { color: "blue" },
          createElement("p", null, "hello"),
          createElement(ComponentButton2, { color: "blue" }, "no")
        );
      }

      function ComponentButton2(props) {
        return createElement("button", { color: props.color }, props.children);
      }

      const element = createElement(
        "div",
        { id: "delete-account" },
        createElement("p", null, "Elements"),
        createElement(ComponentButton1)
      );

      function resolveTree(element, result) {
        if (Array.isArray(element)) {
          return element.map((child) => resolveTree(child, result));
        }

        if (typeof element !== "object" || element === null) {
          return element;
        }

        if (typeof element.type === "function") {
          const componentName = element.type.name || "Anonymous";
          const rendered = element.type(element.props);
          const resolvedRendered = resolveTree(rendered, result);
          result[componentName] = resolvedRendered;
          return { type: componentName };
        }

        const resolvedChildren = resolveTree(element.props.children, result);
        return {
          type: element.type,
          props: {
            ...element.props,
            children: resolvedChildren,
          },
        };
      }

      const result = {};
      const domTree = resolveTree(element, result);
      const finalOutput = {
        ...domTree,
        ...result,
      };

      console.log(JSON.stringify(finalOutput, null, 2));
    </script>
  </body>
</html>
